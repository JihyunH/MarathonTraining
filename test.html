<!DOCTYPE html>
<html lang="en">
<head>
  
  <meta charset="UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Marathon Training</title>
  
    <head>
      <!--Import Google Icon Font-->
      <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <script src="bower_components/jquery/dist/jquery.js"></script>
      <!-- Compiled and minified CSS -->
      <link rel="stylesheet" href="bower_components/materialize/dist/css/materialize.min.css">

      <!-- Compiled and minified JavaScript -->
      <script src="bower_components/materialize/dist/js/materialize.min.js"></script>

      <script src="bower_components/moment/moment.js"></script>
          
      <script type="text/javascript" src="assets/javascript/cleanse.js"></script>
    
    
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">

    <script src="https://www.gstatic.com/firebasejs/3.6.5/firebase.js"></script>


</head>

<body>


<div class="container">

  <div class="row">
    <div class="col s12">
      <nav>
        <div class="nav-wrapper deep-orange">
          <a href="index.html" class="brand-logo">Marathon Training</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="about.html">About</a></li>
            
            <li><a href="contact.html">Contact</a></li>
            <li><a href="register.html">Email Login</a></li>
            <li><a href="login.html">Facebook Login</a></li>
            <li><a target="_blank" href="https://www.fitbit.com/oauth2/authorize?response_type=token&client_id=2283WS&redirect_uri=http%3A%2F%2F127.0.0.1%3A8080%2Findex.html&scope=activity%20heartrate%20location%20profile%20weight&expires_in=604800">Fitbit Login</a></li>
          </ul>
        </div>
      </nav>
        
    </div>
  </div>
</div>

<button id="facebook">Facebook</button>

<div id="timer"></div>
 <footer class="page-footer black-text transparent">
  <div class="container">
    <div class="row">
      <div class="col l6 s12">
        <h5 class="black-text">Footer Content</h5>
       <!--  <p class="grey-text text-lighten-4">You can use rows and columns here to organize your footer content.</p> -->
      </div>
      <div class="col l4 offset-l2 s12">
        <h5 class="black-text">Links</h5>
        <ul>
          <li><a class="red-text" href="#!">Instagram</a></li>
          <li><a class="red-text" href="#!">YouTube</a></li>
          <li><a class="red-text" href="#!">Facebook</a></li>
          <li><a class="red-text" href="#!">Twitter</a></li>
          <li><a class="red-text" href="#!">Contact</a></li>
          
        </ul>
      </div>
    </div>
  </div>
  
  <div class="footer-copyright black-text transparent">
    <div class="container center">
    Â© 2017 Marathon Training 
    </div>
  </div>
</footer>

<script type="text/javascript">
// Initialize Firebase
  var config = {
    apiKey: "AIzaSyA86KcIckWm_hvCyb8iIqRDB0tkL9q_aZI",
    authDomain: "marathontrainer-c4507.firebaseapp.com",
    databaseURL: "https://marathontrainer-c4507.firebaseio.com",
    storageBucket: "marathontrainer-c4507.appspot.com",
    messagingSenderId: "89102549201"
  };

  firebase.initializeApp(config);
  


  var params = {}, queryString = location.hash.substring(1),
      regex = /([^&=]+)=([^&]*)/g, m;

  while (m = regex.exec(queryString)) {
    params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
  }
  console.log('params', params);


  $.ajax({
    url: 'https://api.fitbit.com/1/user/-/profile.json',
    headers: {
      'Authorization': 'Bearer ' + params.access_token
    },
    success: function(data) {
      console.log('fitbit user data', data);

        var userId = data.user.encodedId;
        var userName = data.user.displayName;
        var userImage = data.user.avatar;


        function writeUserData() {
          firebase.database().ref('users/' + userId).set({
            loginAuth: "fitbit",

            fitbitAccessToken: params.access_token,

            username: userName,

            profile_picture: userImage,

            lastLogin: firebase.database.ServerValue.TIMESTAMP
          });
        }

        $.ajax({
          url: 'https://api.fitbit.com/1/user/-/activities/date/2017-01-20.json',
          headers: {
            'Authorization': 'Bearer ' + params.access_token
          },

          success: function(response) {
            console.log('activites data', response);
          },
          error: function(error) {
            console.log(error);
          }

        });
      }
    });

const newYorkMarathon2017 = "11/05/2017 09:20 AM";
const convMarDate = moment(new Date(newYorkMarathon2017));

// countdown clock
var tick;
var countdownClock = {

  time : function() {
    var today = moment(new Date());
      var difference = convMarDate.diff(today, 'seconds');

      return difference;
    },

  start: function() {
      tick = setInterval(countdownClock.countdown, 1000);
    },

    stop: function() {
      clearInterval(tick);
    },

  countdown: function() {
    if (countdownClock.time() === 0) {

          countdownClock.stop();

        } else {

      let currentTime = countdownClock.timeConverter(countdownClock.time());
          $("#timer").text(currentTime);
    }
  },

  timeConverter: function(t) {
      //  Takes the current time in seconds and convert it to minutes and seconds (mm:ss).
      var days = Math.floor(t/86400);
      var hours = Math.floor((t - (days * 86400))/3600);
      var minutes = Math.floor((t - (days * 86400) - (hours * 3600))/60);
      var seconds = t - (days * 86400) - (hours * 3600)- (minutes * 60);
      // allows game time to be altered in the future to more than one minute

      if (seconds < 10) {
        seconds = "0" + seconds;
      }

      if (minutes === 0) {
        minutes = "00";
      }

      else if (minutes < 10) {
        minutes = "0" + minutes;
      }

      if (hours === 0) {
        hours = "00"
      }

      else if (hours < 10) {
        hours = "0" + hours;
      }
      if (days === 0) {
        hours = "00"
      }

      else if (days < 10) {
        days = "0" + hours;
      }
            if (hours === 0) {
        hours = "00"
      }

      else if (hours < 10) {
        hours = "0" + hours;
      }

      return days + " Days " + hours + " Hours " + minutes + " Minutes " + seconds + " Seconds";
    }
}

$(document).ready(function(){
  countdownClock.start();
});
  

</script>


</body>
</html>